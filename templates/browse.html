{% extends 'layout.html' %}
{% block title %}Finder{% endblock %}
{% block content %}
<h2>Search</h2>
<form method="get" class="upload-form">
  <p>
    <label for="q">Search: </label>
    <input name="q" type="text" value="{{q}}">
  </p>
  <button type="submit" class="btn upload-btn">Search</button>
</form>
<h2>Upload Files</h2>
<form method="post" enctype="multipart/form-data" class="upload-form">
  {% csrf_token %} {{ form }}
  <button type="submit" class="btn upload-btn">Upload</button>
</form>
<h2>Create New Folder</h2>
<form method="POST" class="upload-form">
  {% csrf_token %} {{ folder_form.as_p }}
  <button type="submit" class="btn upload-btn">Create New Folder</button>
</form>
{% if success %}
<p class="success">{{ success }}</p>
{% endif %}

{% if drives %}
<h3>Mounted Drives</h3>
<ul>
    {% for drive in drives %}
        <li>
            <a href="{% url 'filemanage:browse_folder' drive %}">{{ drive }}</a>
        </li>
    {% endfor %}
</ul>
{% endif %}

<h2>File Manager - {{ current_path }}</h2>

{% if error %}
<p class="error">{{ error }}</p>
{% endif %}
<p>
  {% if parent_path %}
  <a class="link" href="{% url 'filemanage:browse_folder' parent_path %}"
    >.. (Parent Directory)</a
  >
  {% else %}
  <a class="link" href="{% url 'filemanage:home' %}">(Home Directory)</a>
  {% endif %}
</p>

<h2>Folders</h2>
<ul class="folder-list">
  {% for folder in folders %}
  <li>
    <div class="folder-item">
      <a
        class="folder-link"
        href="{% url 'filemanage:browse_folder' folder_path|add:folder %}"
        >{{ folder }}</a
      >
      <form
        action="{% url 'filemanage:delete_item' folder_path|add:folder %}"
        method="POST"
        class="delete-form"
        onsubmit="return confirmDelete();"
      >
        {% csrf_token %}
        <button type="submit" class="btn delete-btn">Delete</button>
      </form>
    </div>
  </li>
  {% empty %}
  <li>No folders found</li>
  {% endfor %}
</ul>

<h2>Files</h2>
<ul class="file-list">
  {% for file in files %}
  <li>
    <div class="file-item">
      <a
        href="{% if current_path %}{% url 'filemanage:view_file' folder_path=current_path file_name=file %}{% else %}
        {% url 'filemanage:view_file_no_folder' file_name=file %}{% endif %}"
        target="_blank"
        >{{ file }}</a
      >

      <form
        action="{% url 'filemanage:delete_item' folder_path|add:current_path|add:'/'|add:file %}"
        method="POST"
        class="delete-form"
        onsubmit="return confirmDelete();"
      >
        {% csrf_token %}
        <button type="submit" class="btn delete-btn">Delete</button>
      </form>
    </div>
  </li>
  {% empty %}
  <li>No files found</li>
  {% endfor %}
</ul>

<script>
  function confirmDelete() {
    return confirm("Are you sure you want to delete this item? It cannot be restored later.");
  }
</script>
{% endblock %}
